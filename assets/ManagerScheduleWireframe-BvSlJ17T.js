import{r as h,j as e,u as W,f as P}from"./index-6SyhlobN.js";function _({location:i,selectedStudents:r,onStudentToggle:f,students:d,cellTypes:g,onTypeFilterChange:j}){console.log(d);const[p,v]=h.useState(new Set),[c,N]=h.useState(Object.keys(g)),n=s=>{v(l=>{const o=new Set(l);return o.has(s)?o.delete(s):o.add(s),o})},a=s=>{N(l=>{const o=l.includes(s)?l.filter(x=>x!==s):[...l,s];return j?.(o),o})};return e.jsxs("aside",{className:"manager-sidebar",children:[e.jsx("h3",{children:"Students"}),e.jsx("ul",{className:"student-list",children:d.filter(s=>s.location===i).map(s=>e.jsxs("li",{className:"student-item",children:[e.jsxs("div",{className:"student-header",children:[e.jsxs("label",{className:"student-label",children:[e.jsx("input",{type:"checkbox",checked:r.includes(s.id),onChange:()=>f(s.id)})," ",s.name," (",s.id,")"]}),s.notes&&e.jsx("button",{onClick:()=>n(s.id),"aria-expanded":p.has(s.id),className:"expand-toggle",children:p.has(s.id)?"▼":"▶"})]}),p.has(s.id)&&s.notes&&e.jsx("div",{className:"student-notes",children:e.jsx("p",{children:s.notes})})]},s.id))}),e.jsxs("div",{className:"legend-section",children:[e.jsx("h4",{children:"Schedule Legend"}),e.jsx("div",{className:"legend-items",children:Object.entries(g).map(([s,l])=>e.jsxs("div",{className:"legend-item",children:[e.jsx("input",{type:"checkbox",id:`type-filter-${s}`,checked:c.includes(s),onChange:()=>a(s)}),e.jsx("div",{className:"legend-color",style:{backgroundColor:l.color}}),e.jsx("span",{className:"legend-label",children:l.label})]},s))})]})]})}function R(i){const[r,f]=i.split(":"),d=parseInt(r,10),g=d>=12?"PM":"AM";return`${d%12||12}:${f} ${g}`}function z(i,r,f){const d=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"],g=d[r],j=d[f],[p,v]=j.split(":"),c=new Date;c.setHours(parseInt(p,10),parseInt(v,10)),c.setMinutes(c.getMinutes()+30),i==="Fri"&&c.getHours()>=17?c.setHours(17,0):i!=="Fri"&&c.getHours()>=18&&c.setHours(18,0);const N=R(g),n=R(`${String(c.getHours()).padStart(2,"0")}:${String(c.getMinutes()).padStart(2,"0")}`);return`${N} - ${n}`}const V=h.memo(function({days:r,students:f,selectedStudents:d,availability:g,cellTypes:j,selectedTypes:p=[]}){const v=h.useMemo(()=>d.map(n=>f.find(a=>a.id===n)).filter(Boolean).map(n=>n),[d,f]),c=h.useMemo(()=>{const n=new Set,a=[];return r.forEach(s=>{v.forEach(l=>{const o=g[l.id];if(!o||!o[s])return;const x=o[s];for(let m=0;m<x.length;m++){const k=`${l.id}-${s}-${m}`;if(n.has(k))continue;const S=x[m];if(!S||p.length>0&&!p.includes(S)||!(m===0||x[m-1]!==S))continue;let y=m;for(;y+1<x.length&&x[y+1]===S;)y+=1;a.push({day:s,slotIdx:m,studentId:l.id,student:l,status:S,startIdx:m,endIdx:y});for(let C=m;C<=y;C++)n.add(`${l.id}-${s}-${C}`)}})}),a},[r,v,g,p]),N=h.useMemo(()=>{const n=new Map;return v.forEach((a,s)=>{n.set(a.id,s)}),n},[v]);return v.length===0?e.jsx("div",{className:"empty-state",children:"Select students to view their schedules"}):e.jsxs("div",{className:"calendar-container",children:[e.jsxs("div",{className:"calendar-header",children:[e.jsx("div",{className:"time-col-header"}),r.map(n=>e.jsx("div",{className:"day-col-header",children:e.jsx("div",{className:"day-name",children:n})},n))]}),e.jsx("div",{className:"calendar-body",children:["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30"].map((n,a)=>e.jsxs("div",{className:"calendar-time-row",children:[e.jsx("div",{className:"time-label",children:R(n)}),r.map(s=>{const l=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"],o=s==="Fri"?"16:30":"17:30",x=l.indexOf(o);if(a>x)return e.jsx("div",{className:"calendar-day-cell day-cell-empty"},s);const m=c.filter(S=>S.day===s&&S.slotIdx===a),k=v.length;return e.jsx("div",{className:"calendar-day-cell","data-time":n,"data-day":s,children:m.map(({studentId:S,student:$,status:y,endIdx:C,startIdx:E})=>{const M=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"],H=s==="Fri"?"16:30":"17:30",L=M.indexOf(H),t=Math.min(C,L),u=t-E+1,b=u*40,I=j[y]?.color||"#e2e8f0",A=z(s,E,C),T=N.get(S)||0,F=k>0?100/k:100,w=T*F;return e.jsx("div",{className:"schedule-event",title:`${$.name}
${j[y]?.label}
${A}`,"data-tooltip":`${$.name}
${j[y]?.label}
${A}`,style:{height:`${b}px`,minHeight:`${b}px`,maxHeight:`${b}px`,width:`${F}%`,left:`${w}%`,top:"0px",background:I,borderLeftColor:$.color,zIndex:10},"data-debug":`${s}-${n}-${$.name}-h${b}`,children:e.jsxs("div",{className:"event-content",children:[e.jsx("div",{className:"event-name",children:$.name}),e.jsxs("div",{className:"event-status",children:[j[y]?.label,t<C?" (continues...)":` (${u} slots)`]})]})},S)})},s)})]},`${n}-${a}`))})]})});function G(i){const[r,f]=i.split(":"),d=parseInt(r,10),g=d>=12?"PM":"AM";return`${d%12||12}:${f} ${g}`}function q(i){const r=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"];return i==="Fri"?r.slice(0,r.indexOf("17:00")):r.slice(0,r.indexOf("18:00"))}function J({days:i,times:r,students:f,location:d,assignments:g,selectedAssignmentStudent:j,onAssignmentStudentChange:p,onCellAssign:v}){const c=n=>g.filter(s=>s.studentId===n).length*.5,N=f.filter(n=>n.location===d);return e.jsxs("div",{className:"schedule-builder",children:[e.jsx("h3",{children:"Assignment Grid"}),e.jsx("div",{className:"assignment-selector",children:e.jsxs("label",{className:"assignment-label",children:["Click cells to assign:",e.jsxs("select",{className:"assignment-select",value:j,onChange:n=>p(n.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select student"}),N.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]})}),e.jsxs("div",{className:"assignment-grid-container",children:[e.jsxs("div",{className:"assignment-student-column",children:[e.jsx("div",{className:"assignment-student-header",children:"Student (Hours)"}),N.map(n=>e.jsxs("div",{className:"assignment-student-name",style:{borderLeftColor:n.color},children:[e.jsx("span",{className:"student-name-text",children:n.name}),e.jsxs("span",{className:"student-hours",children:["(",c(n.id),"h)"]})]},n.id))]}),e.jsxs("div",{className:"assignment-grid-wrapper",children:[e.jsxs("div",{className:"assignment-grid-header",children:[e.jsx("div",{className:"assignment-time-header"}),i.map(n=>e.jsx("div",{className:"assignment-day-header",children:n},n))]}),r.map((n,a)=>e.jsxs("div",{className:"assignment-grid-row",children:[e.jsx("div",{className:"assignment-time-cell",children:G(n)}),i.map(s=>{const l=q(s);if(a>=l.length)return e.jsx("div",{className:"assignment-cell empty"},s);const o=g.find($=>$.day===s&&$.time===n),x=o?o.studentId:null,m=x?f.find($=>$.id===x):null,k=m?m.color:"#fff",S=m?m.name:null;return e.jsx("div",{onClick:()=>v(s,a),className:"assignment-cell",style:{background:k},children:S},s)})]},n))]})]})]})}const B=["Mon","Tue","Wed","Thu","Fri"],Q=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"],O={available:{label:"Available",color:"#a5d6a7"},notAvailable:{label:"Not Available",color:"#cccccc"},class:{label:"Class",color:"#90caf9"},preferred:{label:"Preferred Shift",color:"#ffd54f"}};function X(){const[i,r]=h.useState("hsl"),[f,d]=h.useState([]),[g,j]=h.useState([]),[p,v]=h.useState(""),{token:c}=W(),[N,n]=h.useState([]),[a,s]=h.useState(!1),[l,o]=h.useState(null),[x,m]=h.useState(!1),[k,S]=h.useState(Object.keys(O)),$=t=>{S(t)},y=t=>{d(u=>u.includes(t)?u.filter(b=>b!==t):[...u,t])},C=(t,u)=>{const I=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"][u],A=g.findIndex(T=>T.day===t&&T.time===I);if(A!==-1){j(T=>T.filter((F,w)=>w!==A));return}p&&j(T=>[...T,{studentId:p,day:t,time:I}])};h.useEffect(()=>{c&&!x&&(async()=>{if(!c){o("No auth token available");return}s(!0),o(null);try{const u=await P(c);n(u),m(!0)}catch(u){const b=u instanceof Error?u.message:"An error occurred while fetching submissions";o(b)}finally{s(!1)}})()},[c,x]);const E=t=>{r(t),d([]),j([]),v("")},M=h.useMemo(()=>N.filter(t=>t.location===i).map((t,u)=>({id:t.studentId,name:t.studentName,color:`hsl(${u*60}, 70%, 60%)`,location:t.location,notes:t.notes||""})),[N,i]),H=h.useMemo(()=>{const t={},u=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"];return N.filter(b=>b.location===i).forEach(b=>{t[b.studentId]={Mon:[],Tue:[],Wed:[],Thu:[],Fri:[]},["Mon","Tue","Wed","Thu","Fri"].forEach(A=>{const T=A==="Fri"?18:21,F=new Array(T).fill(null);b.schedule.forEach(w=>{if(w.day===A){const D=u.indexOf(w.time);D!==-1&&D<T&&(F[D]=w.type)}}),t[b.studentId][A]=F})}),t},[N,i]);h.useEffect(()=>{d(M.map(t=>t.id))},[M]);const L=async()=>{if(c){s(!0),o(null);try{const t=await P(c,void 0,!0);n(t)}catch(t){const u=t instanceof Error?t.message:"An error occurred while refreshing data";o(u)}finally{s(!1)}}};return e.jsxs("div",{className:"manager-root",children:[a&&!x&&e.jsxs("div",{style:{padding:"20px",textAlign:"center"},children:[e.jsx("div",{children:"Loading submissions..."}),e.jsx("div",{style:{fontSize:"14px",marginTop:"10px",color:"#666"},children:"This may take a moment on first load"})]}),l&&e.jsxs("div",{style:{padding:"20px",color:"red",textAlign:"center"},children:["Error: ",l,e.jsx("button",{onClick:L,style:{marginLeft:"10px",padding:"5px 10px"},children:"Retry"})]}),!a&&!l&&N.length===0&&x&&e.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"No submissions available yet."}),(x||!a&&N.length>0)&&!l&&e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"manager-header",children:e.jsxs("div",{className:"manager-header-controls",children:[e.jsxs("label",{className:"location-label",children:["Location:",e.jsxs("select",{value:i,onChange:t=>E(t.target.value),className:"location-select",children:[e.jsx("option",{value:"hsl",children:"HSL"}),e.jsx("option",{value:"med",children:"Med"})]})]}),e.jsx("button",{onClick:L,disabled:a,style:{marginLeft:"15px",padding:"5px 10px",opacity:a?.5:1},children:a?"Refreshing...":"Refresh Data"})]})}),e.jsxs("div",{className:"manager-content",children:[e.jsx(_,{location:i,selectedStudents:f,onStudentToggle:y,students:M,cellTypes:O,onTypeFilterChange:$}),e.jsxs("div",{className:"manager-main",children:[e.jsxs("section",{className:"manager-section",children:[e.jsx("h3",{children:"Student Schedules"}),e.jsx(V,{days:B,students:M,selectedStudents:f,availability:H,cellTypes:O,selectedTypes:k})]}),e.jsx("section",{className:"manager-section",children:e.jsx(J,{days:B,times:Q,students:M,location:i,assignments:g,selectedAssignmentStudent:p,onAssignmentStudentChange:v,onCellAssign:C})})]})]})]})]})}export{X as default};
