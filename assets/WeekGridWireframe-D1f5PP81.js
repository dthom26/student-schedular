import{j as e,u as ce,r as h,a as de,s as ue}from"./index-6SyhlobN.js";function me({studentId:i,setStudentId:o,studentName:a,setStudentName:t,location:r,setLocation:c}){return e.jsxs("div",{className:"student-info",children:[e.jsx("strong",{children:"Student Info:"}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{className:"input input-small",placeholder:"Student ID",value:i,onChange:d=>o(d.target.value)}),e.jsx("input",{className:"input input-medium",placeholder:"Name",value:a,onChange:d=>t(d.target.value)})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("strong",{children:"Location:"}),e.jsxs("select",{className:"select select-wide",value:r,onChange:d=>c(d.target.value),children:[e.jsx("option",{value:"",children:"Select Location"}),e.jsx("option",{value:"hsl",children:"Health Sciences Library (HSL)"}),e.jsx("option",{value:"med",children:"Medical Library (MED)"})]})]})]})}function Y({mode:i,setMode:o,cellTypes:a}){return e.jsxs("div",{className:"mode-picker",children:[e.jsx("strong",{children:"Mode:"}),Object.entries(a).map(([t,{label:r,color:c}])=>e.jsxs("label",{className:"mode-label",children:[e.jsx("input",{type:"radio",name:"mode",value:t,defaultChecked:i===t,onChange:d=>{d.target.checked&&o(t)}}),e.jsx("span",{className:"mode-swatch",style:{background:c}}),r]},t))]})}function Z(i){const[o,a]=i.split(":"),t=parseInt(o,10),r=t>=12?"PM":"AM";return`${t%12||12}:${a} ${r}`}function he(i){const[o,a]=i.split(":"),t=new Date;t.setHours(parseInt(o,10),parseInt(a,10)),t.setMinutes(t.getMinutes()+30);const r=Z(i),c=Z(`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`);return`${r} - ${c}`}function ge({grid:i,times:o,days:a,getTimesForDay:t,cellTypes:r,handleDragStart:c,handleDragMove:d,handleDragEnd:m,isDragging:v,isInDragRange:p,currentMode:N}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"weekgrid-times-row",children:[e.jsx("div",{className:"time-col"}),a.map(x=>e.jsx("div",{className:"day-header",children:x},x))]}),o.map((x,D)=>e.jsxs("div",{className:"time-row",children:[e.jsx("div",{className:"time-col",children:x}),a.map(S=>{const k=t(S);if(D>=k.length)return e.jsx("div",{className:"empty-slot"},S);const j=i[S][D],M=j?r[j].color:"#eee",C=(p?.(S,D)||!1)&&N&&v?r[N]?.color:M;return e.jsx("div",{className:"slot",onMouseDown:I=>{I.preventDefault(),c?.(S,D)},onMouseEnter:()=>d?.(S,D),onMouseUp:m,title:`Set ${j?r[j].label:"Unset"} for ${S} ${he(x)}`,style:{background:C}},S)})]},x))]})}function fe({selectedDay:i,setSelectedDay:o}){const a=["Mon","Tue","Wed","Thu","Fri"];return e.jsxs("div",{className:"day-picker",children:[e.jsx("label",{children:"Select a day:"}),e.jsx("div",{className:"day-buttons",children:a.map(t=>e.jsx("button",{className:`day-button ${i===t?"active":""}`,onClick:()=>o(t),children:t},t))})]})}function ee(i){const[o,a]=i.split(":"),t=parseInt(o,10),r=t>=12?"PM":"AM";return`${t%12||12}:${a} ${r}`}function xe(i){const[o,a]=i.split(":"),t=new Date;t.setHours(parseInt(o,10),parseInt(a,10)),t.setMinutes(t.getMinutes()+30);const r=ee(i),c=ee(`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`);return`${r} - ${c}`}function Se({day:i,slots:o,times:a,onSlotClick:t,cellTypes:r}){return e.jsxs("div",{className:"single-day-grid",children:[e.jsxs("h4",{style:{marginTop:0,marginBottom:12},children:[i,"'s Schedule"]}),e.jsx("div",{className:"single-day-slots",children:a.map((c,d)=>{if(d>=o.length)return null;const m=o[d],v=m?r[m].color:"#eee",p=m?r[m].label:"Unset",N=xe(c);return e.jsxs("div",{className:"single-slot-row",children:[e.jsx("div",{className:"slot-time",children:c}),e.jsx("button",{className:"single-slot",onClick:()=>t(d),style:{background:v},title:`${p} - ${N}`})]},c)})})]})}function pe(i,o){const a=[],t=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"];return Object.entries(i).forEach(([r,c])=>{const d=r;c.forEach((m,v)=>{if(m!==null){const p=t[v];if(a.push({day:d,time:p,type:m}),(d==="Fri"&&p==="16:30"||d!=="Fri"&&p==="17:30")&&(m==="class"||m==="notAvailable")){const S=d==="Fri"?"17:00":"18:00";a.push({day:d,time:S,type:m})}}})}),a}function je(i,o,a,t,r,c){return{student:{id:o,name:a,location:t},schedule:pe(i),notes:r,submittedAt:new Date().toISOString()}}const se=["Mon","Tue","Wed","Thu","Fri"],F=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00"],W=i=>i==="Fri"?F.slice(0,F.indexOf("17:00")):F.slice(0,F.indexOf("18:00")),U={available:{label:"Available",color:"#a5d6a7"},notAvailable:{label:"Not Available",color:"#cccccc"},class:{label:"Class",color:"#90caf9"},preferred:{label:"Preferred Shift",color:"#ffd54f"}},B=se.reduce((i,o)=>(i[o]=W(o).map(()=>null),i),{});function ye(){const{studentData:i}=ce(),[o,a]=h.useState(B),[t,r]=h.useState("available"),[c,d]=h.useState(""),[m,v]=h.useState(""),[p,N]=h.useState(""),[x,D]=h.useState("Mon"),[S,k]=h.useState(""),[j,M]=h.useState(!1),[y,C]=h.useState(null),[I,E]=h.useState(null),[$,A]=h.useState(null),[L,z]=h.useState(!1),[H,O]=h.useState(null),[P,te]=h.useState(!1),[G]=h.useState(!1),[Q,V]=h.useState(!1);h.useEffect(()=>{if(i&&(d(i.studentId),v(i.studentName),N(i.location),te(i.isReturning),V(i.isReturning),i.existingSubmission)){k(i.existingSubmission.notes||"");const n={...B};i.existingSubmission.schedule.forEach(s=>{const u=W(s.day).indexOf(s.time);u!==-1&&(n[s.day][u]=s.type)}),a(n)}},[i]);const ne=(n,s)=>{$&&clearTimeout($);const l=_(n,s);if(l&&(l.isStart||l.isEnd)){C({day:n,idx:s});const u=setTimeout(()=>{z(!0),l.isStart?O({day:n,idx:l.rangeEnd}):O({day:n,idx:l.rangeStart}),M(!0),E({day:n,idx:s})},150);A(u)}else{z(!1),O(null),C({day:n,idx:s});const u=setTimeout(()=>{M(!0),E({day:n,idx:s})},150);A(u)}},ie=(n,s)=>{y&&!j?(y.day!==n||y.idx!==s)&&($&&(clearTimeout($),A(null)),M(!0),E({day:n,idx:s})):j&&E({day:n,idx:s})},ae=()=>{if($&&(clearTimeout($),A(null)),j&&y&&I){const{day:n,idx:s}=y,{day:l,idx:u}=I;if(n===l)if(L&&H){const f=H.idx,g=w(f,u),b=_(n,s);if(b){const T=w(b.rangeStart,b.rangeEnd);a(R=>({...R,[n]:R[n].map((J,K)=>T.includes(K)?null:J)})),setTimeout(()=>{a(R=>({...R,[n]:R[n].map((J,K)=>g.includes(K)?t:J)}))},0)}}else{const f=w(s,u);a(g=>({...g,[n]:g[n].map((b,T)=>f.includes(T)?t:b)}))}}else if(y&&!j){const{day:n,idx:s}=y,l=_(n,s);(l&&!L||!l||!L)&&q(n,s)}M(!1),C(null),E(null),z(!1),O(null)};function w(n,s){const[l,u]=[Math.min(n,s),Math.max(n,s)];return Array.from({length:u-l+1},(f,g)=>l+g)}const _=(n,s)=>{const l=o[n],u=l[s];if(!u)return null;let f=s,g=s;for(;f>0&&l[f-1]===u;)f--;for(;g<l.length-1&&l[g+1]===u;)g++;if(f===g)return null;const b=s===f,T=s===g;return!b&&!T?null:{isStart:b,isEnd:T,rangeStart:f,rangeEnd:g}},oe=(n,s)=>{if(!j||!y||!I)return!1;const{day:l,idx:u}=y,{day:f,idx:g}=I;if(n!==l||l!==f)return!1;if(L&&H){const b=H.idx;return w(b,g).includes(s)}else return w(u,g).includes(s)},q=(n,s)=>{a(l=>({...l,[n]:l[n].map((u,f)=>f===s?u===null?t:null:u)}))},le=n=>{q(x,n)},re=async()=>{const n=je(o,c,m,p,S);try{let s;P?(s=await de(c,n),console.log("Update successful:",s),alert("Schedule updated successfully!")):(s=await ue(n),console.log("Submission successful:",s),alert("Schedule submitted successfully!")),P?V(!0):(a(B),d(""),v(""),N(""),k(""))}catch(s){console.error("Submission failed:",s);const l=s instanceof Error?s.message:String(s);l.includes("already exists")||l.includes("409")?alert('This student ID already has a submission. Please use the "Returning Student" option to update your schedule.'):alert(`Failed to ${P?"update":"submit"}. Please try again.`)}},X=c.trim()&&m.trim()&&p;return e.jsxs("div",{className:"weekgrid-root",children:[e.jsxs("div",{className:"weekgrid-left",children:[e.jsxs("div",{style:{marginBottom:"20px",padding:"15px",backgroundColor:"#f5f5f5",borderRadius:"5px"},children:[e.jsx("h3",{children:"Student Information"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Student ID:"})," ",c]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",m]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Location:"})," ",p]}),Q&&e.jsx("p",{style:{color:"#4caf50"},children:"✓ Editing existing submission"})]}),e.jsx(Y,{mode:t,setMode:r,cellTypes:U}),e.jsx(ge,{grid:o,times:F,days:se,getTimesForDay:W,cellTypes:U,handleDragStart:ne,handleDragMove:ie,handleDragEnd:ae,isDragging:j,isInDragRange:oe,currentMode:t})]}),e.jsxs("div",{className:"mobile-controls",children:[e.jsx("div",{className:"mobile-student-info",children:e.jsx(me,{studentId:c,setStudentId:d,studentName:m,setStudentName:v,location:p,setLocation:N})}),e.jsx("div",{className:"mobile-mode-picker",children:e.jsx(Y,{mode:t,setMode:r,cellTypes:U})}),e.jsx(fe,{selectedDay:x,setSelectedDay:D}),e.jsx(Se,{day:x,slots:o[x],times:W(x),onSlotClick:le,cellTypes:U})]}),e.jsxs("div",{className:"sidebar-right",children:[e.jsxs("div",{children:[e.jsx("button",{onClick:()=>a(B),children:"Clear"})," ",e.jsx("button",{disabled:!X||G,onClick:re,children:G?"Loading...":P?"Update Schedule":"Submit Schedule"}),!X&&e.jsx("div",{className:"warning",children:"Please enter your Student ID, Name, and select a Location to submit."}),Q&&!G&&e.jsx("div",{style:{marginTop:"10px",color:"#4caf50",fontSize:"14px"},children:"✓ Found existing submission - you can update your schedule"}),G&&e.jsx("div",{style:{marginTop:"10px",color:"#666",fontSize:"14px"},children:"Checking for existing submission..."})]}),e.jsxs("div",{className:"notes",children:[e.jsx("h3",{children:"Notes"}),e.jsx("textarea",{rows:4,placeholder:"Add notes here...",value:S,onChange:n=>k(n.target.value)})]})]})]})}export{ye as default};
